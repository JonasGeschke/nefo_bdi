---
title: "Analyse der NeFo-GEOEssential-Umfrage zur Biodiversitätsdatenintegration"
date: "2018"
header-includes:
   - \usepackage{longtable}
output:
  pdf_document:
    toc: yes
  documentclass: article
  html_document:
    toc: yes
  classoption: a4paper
  graphics: yes
---

# Einleitung
Dieses ist das Skript der Analyse der NeFo-GEOEssential-Umfrage zur Biodiversitätsdatenintegration. Das Skrpit ist verfügbar unter https://github.com/JonasGeschke/nefo_bdi


# Einstellungen

```{r set wd - CHOOSE, eval=FALSE}
# If your working directory is not already specified because you are running this
# script within a project, you will need to use the setwd() function below to set
# the path of your working directory. In order to do this just copy the path
# between the quote signs.
# Please note: The different levels of the path need to be separated by slashes
# ("/"), not by backslashes ("\") which are the windows default.
# 
# setwd("")

setwd("U:/Workshops_orga/Biodiv_Datenintegration/Umfrage/R") # Jonas
```

```{r install packages, eval=FALSE}
# Installing required packages if not installed yet
if("xlsx" %in% rownames(installed.packages())   == FALSE){
  install.packages("xlsx")}
```

```{r set additional functions, eval=FALSE}
'%!in%' <- function(x,y)!('%in%'(x,y))
```


# Analyse

```{r Laden der Rohdaten und Vorbereitung der Daten, eval=FALSE}
## Load raw data
Raw_deutsch <- read.csv2(file = "Daten/umfrage_zur_biodiversitatsdatenintegration_in_deutschland.csv", 
                         header = F, sep = ";", fileEncoding = "UTF8", 
                         na.strings = "", stringsAsFactors = FALSE)
Raw_englisch <- read.csv2(file = "Daten/questionnaire_on_integration_of_biodiversity_data_in_germany.csv", 
                          header = F, sep = ";", fileEncoding = "UTF8", 
                          na.strings = "", stringsAsFactors = FALSE)

gesamt <- rbind(Raw_deutsch[-which(Raw_deutsch$V9 == "nefo"),], Raw_englisch[-c(1:3, which(Raw_englisch$V9 == "nefo")),])
gesamt <- gesamt[-c(1:3),-c(1,3:9)]

# Qualitative Antworten
Q1_1 <- gesamt[,c(1:5)]
names(Q1_1) <- c("Datenbereitstellung", "Datenaufbereitung", "Datenverschmelzung", "anderes", "Info")
xlsx::write.xlsx(Q1_1, file = "Q1_1.xls")

Q1_3 <- gesamt[,7]
xlsx::write.xlsx(Q1_3, file = "Q1_3.xls")

Q1_4 <- gesamt[,c(8:10)]
names(Q1_4) <- c("a", "b", "c")
xlsx::write.xlsx(Q1_4, file = "Q1_4.xls")

Q1_5 <- gesamt[,c(11:13)]
names(Q1_5) <- c("a", "b", "c")
xlsx::write.xlsx(Q1_5, file = "Q1_5.xls")

Q1_6 <- gesamt[,c(14:16)]
names(Q1_6) <- c("a", "b", "c")
xlsx::write.xlsx(Q1_6, file = "Q1_6.xls")

Q3_2 <- gesamt[,c(29:36)]
names(Q3_2) <- c("LIDAR", "RADAR", "Multi", "Hyper", "Wärme", "Ortho", "andere", "Info")
xlsx::write.xlsx(Q3_2, file = "Q3_2.xls")

Q3_5 <- gesamt[,c(85:98)]
names(Q3_5) <- c("NBS", "EU-BS", "GAP", "Natura", "FFH", "CBD", "IPBES", "CITES", "CMS", "EUROBATS", "Ramsar", "GEO", "andere", "Info")
xlsx::write.xlsx(Q3_5, file = "Q3_5.xls")

Q3_6 <- gesamt[,c(99:101)]
Q3_6[9,1] <- NA
xlsx::write.xlsx(Q3_6, file = "Q3_6.xls")

Q4_4 <- gesamt[,c(111:112)]
names(Q4_4) <- c("Tätigkeit", "Info")
xlsx::write.xlsx(Q4_4, file = "Q4_4.xls")

Feedback <- gesamt[,118]
Feedback[c(22,43)] <- NA
xlsx::write.xlsx(Feedback, file = "Feedback.xls")

# Quantitative Antworten
results <- xlsx::read.xlsx(file = "Daten/results.xlsx", sheetIndex = 1, encoding="UTF-8")
Q1_1 <- factor(results$Q1_1, levels = c("Datenbereitstellung", 
                                        "Datenaufbereitung",
                                        "Datenverschmelzung",
                                        "Mit keinem 'dieser' Schritte"))
Q1_2 <- factor(results$Q1_2, levels = c("0 bis 25%", 
                                        "26 bis 50%",
                                        "51 bis 75%",
                                        "76 bis 100%"))
Q2_1 <- factor(results$Q2_1, levels = c("Ja", 
                                        "Nein"))
Q2_4 <- factor(results$Q2_4, levels = c("Ja", 
                                        "Nein",
                                        "In Teilen"))
Q3_1 <- factor(results$Q3_1, levels = c("Ja", 
                                        "Nein"))
Q3_2 <- factor(results$Q3_2, levels = c("Light Detection and Ranging (LIDAR)", 
                                        "Radio Detection and Ranging (RADAR)",
                                        "Multispektrale Bilder",
                                        "Hyperspektrale Bilder",
                                        "Wärmebilder",
                                        "Luftbilder/ Orthophotos",
                                        "Andere"))
Q3_3 <- factor(results$Q3_3, levels = c("Biodiversitätsmonitoring", 
                                        "Politische Berichterstattung",
                                        "Forschung",
                                        "Planung",
                                        "Beratung",
                                        "Andere privatwirtschaftliche Zwecke"))
Q3_5 <- factor(results$Q3_5, levels = c("Deutsche Nationale Biodiversitätsstrategie", 
                                        "Europäische Biodiversitätsstrategie",
                                        "Gemeinsame Agrarpolitik der EU (GAP)",
                                        "Natura 2000",
                                        "Fauna-Flora-Habitat-Richtlinie (FFH)",
                                        "Übereinkommen über die biologische Vielfalt (CBD)",
                                        "Intergovernmental science-policy Platform on Biodiversity and Ecosystem Services (IPBES)",
                                        "Washingtoner Artenschutzabkommen (CITES",
                                        "Übereinkommen zur Erhaltung wandernder wild lebender Tierarten (CMS)",
                                        "Abkommen zur Erhaltung der europäischen Fledermauspopulationen (EUROBATS)",
                                        "Übereinkommen über Feuchtgebiete (Ramsar)",
                                        "Group on Earth Observations (GEO)",
                                        "Andere"))
Q4_1 <- factor(results$Q4_1, levels = c("Männlich", 
                                        "Weiblich"))
Q4_2 <- factor(results$Q4_2, levels = c("25-34 Jahre", 
                                        "35-44 Jahre", 
                                        "45-59 Jahre", 
                                        "60-69 Jahre", 
                                        "70 Jahre und älter"))
Q4_3 <- factor(results$Q4_3, levels = c("Sekundarstufe II", 
                                        "Abitur", 
                                        "Master", 
                                        "Diplom", 
                                        "Promotion", 
                                        "Habilitation"))
Q4_4 <- factor(results$Q4_4, levels = c("Professor_in",
                                        "Post-Doc",
                                        "Wissenschaftliche_r Angestellte_r ohne Doktortitel",
                                        "Doktorand_in",
                                        "Technische_r Angestellte_r",
                                        "Angestellte_r in Administration und Management",
                                        "Andere"))
Q4_5 <- factor(results$Q4_5, levels = c("Akademische Tätigkeit: Forschung",
                                        "Akademische Tätigkeit: Forschung und Lehre",
                                        "Regierung oder Behörde",
                                        "Privatwirtschaft",
                                        "Verein oder NGO"))
Q4_6 <- factor(results$Q4_6, levels = c("Lokal/ Regional innerhalb Deutschland",
                                        "National in Gesamt-Deutschland",
                                        "Europa",
                                        "International (über Europa hinaus)"))

Q2_2 <- xlsx::read.xlsx(file = "Daten/results.xlsx", sheetIndex = 2, encoding="UTF-8")
row.names(Q2_2) <- Q2_2[,1]
Q2_2 <- t(Q2_2[,-1])

Q2_3 <- xlsx::read.xlsx(file = "Daten/results.xlsx", sheetIndex = 3, encoding="UTF-8")
row.names(Q2_3) <- Q2_3[,1]
Q2_3 <- t(Q2_3[,-1])

Q3_4 <- xlsx::read.xlsx(file = "Daten/results.xlsx", sheetIndex = 4, encoding="UTF-8")
row.names(Q3_4) <- Q3_4[,1]
Q3_4 <- t(Q3_4[,-1])



```

```{r Ergebnisse roh, eval=FALSE}
ergebnisse <- read.csv2(file = "Daten/ergebnisse.csv", 
                         header = TRUE, sep = ";", fileEncoding = "UTF8", 
                         na.strings = "", stringsAsFactors = FALSE)
ergebnisse[ergebnisse == "X"] <- 1

Q1_1 <- ergebnisse[,c(2:5)]
Q1_1 <- transform(Q1_1, X1_1_a = as.numeric(X1_1_a), 
                        X1_1_b = as.numeric(X1_1_b), 
                        X1_1_c = as.numeric(X1_1_c), 
                        X1_1_d = as.numeric(X1_1_d))

Q1_2 <- factor(ergebnisse$X1_2, levels = c("1_2_a", "1_2_b", "1_2_c", "1_2_d"))

Q2_1 <- factor(ergebnisse$X2_1, levels = c("2_1_a", "2_1_b"))

Q2_2 <- factor(ergebnisse[,c(19:22)], levels = c("2_2_a", "2_2_b", "2_2_c", "2_2_d")) ########################################
Q2_2 <- transform(Q2_2, X2_2_a = as.numeric(X2_2_a), 
                        X2_2_b = as.numeric(X2_2_b), 
                        X2_2_c = as.numeric(X2_2_c), 
                        X2_2_d = as.numeric(X2_2_d))
```


# Visualisierung

```{r Barplots, eval=FALSE}
Q1_1_sum <- colSums(Q1_1, na.rm = TRUE)
Q1_1_rel <- 100/sum(Q1_1_sum)*Q1_1_sum
q1_1 <- barplot(Q1_1_rel,
        main = "Mit welchem dieser Schritte der Biodiversitätsdatenintegration beschäftigen Sie sich?", 
        sub = paste("total n", "=", length(rowSums(Q1_1, na.rm=T)!=0), sep = " "),
        names.arg = c("Datenbereitstellung", "Datenaufbereitung", "Datenverschmelzung", "Mit keinem 'dieser' Schritte"),
        ylim = c(0,max(Q1_1_rel)+5), yaxt='n')
text(x = q1_1, y = Q1_1_rel, label = paste("n = ", Q1_1_sum, " / ", round(Q1_1_rel, digits = 0), "%", sep = ""), pos = 3, cex = 0.8, col = "black")

Q1_2_sum <- as.numeric(table(Q1_2))
names(Q1_2_sum) <- c("1_2_a", "1_2_b", "1_2_c", "1_2_d")
Q1_2_rel <- 100/sum(Q1_2_sum)*Q1_2_sum
q1_2 <- barplot(Q1_2_rel,
        main = "Wie viel Prozent Ihrer Arbeitszeit beschäftigen Sie sich mit der Biodiversitätsdatenintegration?", 
        sub = paste("total n", "=", length(ergebnisse$X1_2[!is.na(ergebnisse$X1_2) == T]), sep = " "),
        names.arg = c("0 bis 25%", "26 bis 50%", "51 bis 75%", "76 bis 100%"),
        ylim = c(0,max(Q1_2_rel)+5), yaxt='n')
text(x = q1_2, y = Q1_2_rel, label = paste("n = ", Q1_2_sum, " / ", round(Q1_2_rel, digits = 0), "%", sep = ""), pos = 3, cex = 0.8, col = "black")

Q2_1_sum <- as.numeric(table(Q2_1))
names(Q2_1_sum) <- c("2_1_a", "2_1_b")
Q2_1_rel <- 100/sum(Q2_1_sum)*Q2_1_sum
q2_1 <- barplot(Q2_1_rel,
        main = "Haben Sie bereits von den FAIR-Prinzipien gehört?", 
        sub = paste("total n", "=", length(ergebnisse$X2_1[!is.na(ergebnisse$X2_1) == T]), sep = " "),
        names.arg = c("Ja", "Nein"),
        ylim = c(0,max(Q2_1_rel)+5), yaxt='n')
text(x = q2_1, y = Q2_1_rel, label = paste("n = ", Q2_1_sum, " / ", round(Q2_1_rel, digits = 0), "%", sep = ""), pos = 3, cex = 0.8, col = "black")

Q2_2_sum <- as.numeric(table(Q2_2)) ########################################
names(Q2_2_sum) <- c("2_2_a", "2_2_b", "2_2_c", "2_2_d")
Q2_2_rel <- 100/sum(Q2_2_sum)*Q2_2_sum
q2_2 <- barplot(Q2_2_rel,
        main = "Haben Sie bereits von den FAIR-Prinzipien gehört?", 
        sub = paste("total n", "=", length(ergebnisse$X2_2[!is.na(ergebnisse$X2_2) == T]), sep = " "),
        names.arg = c("2_2_a", "2_2_b", "2_2_c", "2_2_d"),
        ylim = c(0,max(Q2_1_rel)+5), yaxt='n')
text(x = q2_2, y = Q2_1_rel, label = paste("n = ", Q2_2_sum, " / ", round(Q2_2_rel, digits = 0), "%", sep = ""), pos = 3, cex = 0.8, col = "black")
```

